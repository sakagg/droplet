<html>
  <head>
    <link rel="stylesheet" href="lib/qunit.css"/>
    <style>
      #hidden {
        position: absolute;
        top: -9999px;
        left: -9999px;
        height: 300px;
        width: 500px;
      }
    </style>
  </head>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <div id="hidden">
    <canvas id="main"></canvas>
    <div id="test-main">
    </div>
    <div id="test-palette">
    </div>
  </div>
  <script src="../vendor/ace/ace.js"></script>
  <script src="lib/jquery.min.js"></script>
  <script src="../vendor/qunit.js"></script>

  asyncTest('JS Custom Colors', function() {
    var customJS, customSerialization, expectedSerialization;
    customJS = new JavaScript({
      categories: {
        functions: {color: '#111'},
        returns: {color: '#222'},
        comments: {color: '#333'},
        arithmetic: {color: '#444'},
        containers: {color: '#666'},
        assignments: {color: '#777'},
        loops: {color: '#888'},
        conditionals: {color: '#999'},
        value: {color: '#aaa'},
        command: {color: '#bbb'}
      }
    });
    customSerialization = customJS.parse(
        'return b != (a += [c + d][0]);').serialize();
    expectedSerialization =
      '<segment' +
      '  isLassoSegment="false"' +
      '><block' +
      '  precedence="0"' +
      '  color="#222"' +  // returns
      '  socketLevel="0"' +
      '  classes="ReturnStatement mostly-block"' +
      '>return <socket' +
      '  precedence="0"' +
      '  handwritten="false"' +
      '  classes=""' +
      '><block' +
      '  precedence="9"' +
      '  color="cyan"' +  // logic - not overridden
      '  socketLevel="0"' +
      '  classes="BinaryExpression mostly-value"' +
      '><socket' +
      '  precedence="9"' +
      '  handwritten="false"' +
      '  classes=""' +
      '>b</socket' +
      '> != <socket' +
      '  precedence="9"' +
      '  handwritten="false"' +
      '  classes=""' +
      '><block' +
      '  precedence="0"' +
      '  color="#777"' +  // assignment
      '  socketLevel="0"' +
      '  classes="mostly-block AssignmentExpression"' +
      '>(<socket' +
      '  precedence="0"' +
      '  handwritten="false"' +
      '  classes=""' +
      '>a</socket' +
      '> += <socket' +
      '  precedence="0"' +
      '  handwritten="false"' +
      '  classes=""' +
      '><block' +
      '  precedence="1"' +
      '  color="#666"' +  // containers
      '  socketLevel="0"' +
      '  classes="MemberExpression mostly-value"' +
      '><socket' +
      '  precedence="0"' +
      '  handwritten="false"' +
      '  classes=""' +
      '><block' +
      '  precedence="0"' +
      '  color="#666"' +  // containers
      '  socketLevel="0"' +
      '  classes="ArrayExpression mostly-value"' +
      '>[<socket' +
      '  precedence="0"' +
      '  handwritten="false"' +
      '  classes=""' +
      '><block' +
      '  precedence="6"' +
      '  color="#444"' +   // arithmetic
      '  socketLevel="0"' +
      '  classes="BinaryExpression mostly-value"' +
      '><socket' +
      '  precedence="6"' +
      '  handwritten="false"' +
      '  classes=""' +
      '>c</socket' +
      '> + <socket' +
      '  precedence="6"' +
      '  handwritten="false"' +
      '  classes=""' +
      '>d</socket></block></socket' +
      '>]</block></socket' +
      '>[<socket' +
      '  precedence="0"' +
      '  handwritten="false"' +
      '  classes=""' +
      '>0</socket' +
      '>]</block></socket' +
      '>)</block></socket></block></socket' +
      '>;</block></segment>';
    strictEqual(
        helper.xmlPrettyPrint(customSerialization),
        helper.xmlPrettyPrint(expectedSerialization),
        'JS Custom colors work');
    start();
  });

  asyncTest('JS LogicalExpressions', function() {
    var customJS, customSerialization, expectedSerialization;
    customJS = new JavaScript();
    customSerialization = customJS.parse(
        'a && b').serialize();
    expectedSerialization =
        '<segment' +
        '  isLassoSegment="false"' +
        '><block' +
        '  precedence="13"' +
        '  color="cyan"' +
        '  socketLevel="0"' +
        '  classes="LogicalExpression mostly-value"' +
        '><socket' +
        '  precedence="13"' +
        '  handwritten="false"' +
        '  classes=""' +
        '>a</socket> &amp;&amp; ' +
        '<socket' +
        '  precedence="13"' +
        '  handwritten="false"' +
        '  classes=""' +
        '>b</socket></block></segment>';
    strictEqual(
        helper.xmlPrettyPrint(customSerialization),
        helper.xmlPrettyPrint(expectedSerialization),
        'Logical expression precedences are assigned.');
    start();
  });
});
</script>
  <script src="js/jstest.js"></script>
</html>
